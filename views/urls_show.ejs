<!DOCTYPE html>
<html lang="en">
  <%- include('partials/_head.ejs') %>
  <body>
    <%- include('partials/_header') %>
    <div class="card text-center">
      <div class="card-header"></div>
      <div class="card-body">
        <h5 class="card-title">TinyURL for: <%= url['longURL'] %></h5>
        <p class="card-text">
          Short URL ID: <a href="/u/<%= id %>" target="_blank"><%= id %></a>
        </p>
      </div>
      <div class="card-body">
        <h5 class="card-title">EDIT</h5>
        <form class="form-inline justify-content-center" action="/urls/<%= id %>?_method=put" method="POST">
          <div class="form-group mb-2">
            <label for="longURL">New URL:</label>
            <input
              class="form-control"
              type="text"
              name="newLongURL"
              value="<%= url['longURL'] %>"
              style="width: 300px; margin: 1em"
            />
            <button type="submit" class="btn btn-primary">Edit</button>
          </div>
        </form>
      </div>
      <div class="card-body">
        <table class="table" style="text-align: center;">
          <thead>
            <tr>
              <th scope="col">Total Visits</th>
              <th scope="col">Unique Visitors</th>
              <th scope="col">Created Date</th>
            </tr>
          </thead>
          <tbody>
            <% const visitors = url["visitHistories"].map(h => h['visitorId']); %>
            <% const uniqueVisitors = new Set(visitors); %>
            <tr>
              <td style="vertical-align: middle;"><%= url["visitHistories"].length %></td>
              <td style="vertical-align: middle;"><%= uniqueVisitors.size %></td>
              <td style="vertical-align: middle;"><%= url["createdDate"] %></td>
            </tr>
          </tbody>
        </table>
        <h5 class="card-title">VISIT HISTORY</h5>
        <table class="table" style="text-align: center;">
          <thead>
            <tr>
              <th scope="col" style="width: 50%;">Time</th>
              <th scope="col" style="width: 50%;">Visitor ID</th>
            </tr>
          </thead>
          <tbody>
            <% for (const history of url['visitHistories']) { %>
              <tr>
                <td style="vertical-align: middle;"><%= history['time'] %></td>
                <td style="vertical-align: middle;"><%= history['visitorId'] %></td>
              </tr>
            <% } %>
          </tbody>
        </table>
        </div>
      <div class="card-footer text-muted"></div>
    </div>
    <%- include('partials/_bootstrap') %>
  </body>
</html>
